/*! message_board 2015-08-09 */
function getData(){$.ajax({type:"GET",url:"/messenger",success:function(a){loadDisplay(a)}})}function loadDisplay(a){$(".display").empty();for(var b=0;b<a.length;b++)writeCard(a,b)}function updateData(){$.ajax({type:"GET",url:"/messenger",success:function(a){testObjIndex>a.length-1?(console.log("Data missmatch"),loadDisplay(a)):a[testObjIndex]._id==testObjId?(console.log("Data Match"),updateDisplay(a)):(console.log("Data missmatch"),console.log(a[testObjIndex]._id+" Doesn't equal "+testObjId),loadDisplay(a))}})}function updateDisplay(a){for(var b=testObjIndex+1;b<a.length;b++)writeCard(a,b),$(".display .card").first().hide().delay(500).slideDown();recalcTime()}function writeCard(a,b){$(".display").prepend('<div class="card col-xs-12"></div>'),$(".display .card").first().append('<div class="content"></div>');var c=$(".display .content").first();c.append('<img src="/assets/imgs/blank_user.jpg" alt="user avatar" class="avatar">'),c.append('<div class="name">'+a[b].name+"</div>"),c.append('<div class="time" data-timestamp="'+a[b].timestamp+'">'+moment(a[b].timestamp).fromNow()+"</div>"),c.append('<div class="message">'+a[b].message+"</div>"),testObjId=a[b]._id,testObjIndex=b}function recalcTime(){$(".time").each(function(){var a=$(this).attr("data-timestamp");$(this).text(moment(a).fromNow())})}var testObjIndex=0,testObjId;moment.locale("en-my-settings",{relativeTime:{future:"in %s",past:"%s ago",s:"%ds",m:"%dm",mm:"%dm",h:"%dh",hh:"%dh",d:"%dd",dd:"%dd",M:"%dm",MM:"%dm",y:"%dy",yy:"%dy"}}),$(document).ready(function(){$("#inputForm").submit(function(a){a.preventDefault();var b=$("#inputForm").serialize();$("textarea").val(""),console.log(b),$.ajax({type:"POST",url:"/messenger",data:b,success:function(){updateData()}})}),$(".refresh-btn").on("click",function(){updateData()}),getData();setInterval(function(){updateData()},3e4)});